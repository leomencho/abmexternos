<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">
<head>
  <title>Nuevo Registro</title>
</head>

<body>
<section layout:fragment="content">
  <div class="container mt-4">
    <h2 class="mb-4">Nuevo Registro</h2>

    <form method="post" action="/api/usuarios" enctype="multipart/form-data" class="row g-3">

      <!-- Foto con preview -->
      <div class="col-12 text-center">
        <label class="form-label d-block">Foto de Perfil</label>
        <label for="fotoInput">
          <img id="fotoPreview" src="/default-avatar.png" alt="Foto" class="img-thumbnail"
               style="width:150px; height:150px; object-fit:cover; cursor:pointer;">
        </label>
        <input type="file" id="fotoInput" name="foto" class="d-none" onchange="previewFoto(this)">
      </div>

      <!-- Nombre y Apellido -->
      <div class="col-md-6">
        <label class="form-label">Nombre</label>
        <input type="text" name="nombre" maxlength="50" class="form-control" required>
      </div>
      <div class="col-md-6">
        <label class="form-label">Apellido</label>
        <input type="text" name="apellido" maxlength="50" class="form-control" required>
      </div>

      <!-- DNI, CUIL, Fecha -->
      <div class="col-md-4">
        <label class="form-label">DNI</label>
        <input type="number" name="dni" maxlength="11" class="form-control" required>
      </div>
      <div class="col-md-4">
        <label class="form-label">CUIL</label>
        <input type="text" name="cuil" pattern="\d{2}-\d{8}-\d" class="form-control" placeholder="XX-XXXXXXXX-X" required>
      </div>
      <div class="col-md-4">
        <label class="form-label">Fecha de Nacimiento</label>
        <input type="date" name="fecha_nac" class="form-control" required>
      </div>

      <!-- Email -->
      <div class="col-md-6">
        <label class="form-label">Email</label>
        <input type="email" name="mail" maxlength="50" class="form-control" required>
      </div>

      <!-- Programa -->
      <div class="col-md-6">
        <label class="form-label">Programa</label>
        <select name="programa" class="form-select" required>
          <option value="" disabled selected>Seleccione un programa</option>
          <option th:each="p : ${programas}" th:value="${p.id}" th:text="${p.nombre}"></option>
        </select>
      </div>

      <!-- Función -->
      <div class="col-md-6">
        <label class="form-label">Función</label>
        <select name="funcion" class="form-select">
          <option value="" disabled selected>Seleccione una función</option>
          <option th:each="f : ${funciones}" th:value="${f.id}" th:text="${f.nombre}"></option>
        </select>
      </div>

      <!-- Reporta -->
      <div class="col-md-6">
        <label class="form-label">Reporta a</label>
        <select name="reporta" class="form-select">
          <option value="" disabled selected>Seleccione un responsable</option>
          <option th:each="u : ${usuarios}" th:value="${u.id}" th:text="${u.nombre} + ' ' + ${u.apellido}"></option>
        </select>
      </div>

      <!-- Estado, Perfil, Contraseña -->
      <div class="col-md-3">
        <label class="form-label">Estado</label>
        <select name="estado" class="form-select form-select-sm">
          <option value="activo">Activo</option>
          <option value="desactivado">Desactivado</option>
          <option value="pausado">Pausado</option>
          <option value="pre-aprobado">Pre-Aprobado</option>
        </select>
      </div>
      <div class="col-md-3">
        <label class="form-label">Perfil</label>
        <select name="perfil" class="form-select form-select-sm">
          <option value="admin">Admin</option>
          <option value="rrhh">RRHH</option>
          <option value="usuario">Usuario</option>
        </select>
      </div>
      <div class="col-md-6">
        <label class="form-label">Contraseña</label>
        <input type="password" name="pass" maxlength="50" class="form-control" required>
      </div>

      <!-- Recursos -->
      <div class="col-md-12">
        <label class="form-label">Recursos</label>
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="checkbox" name="recursos" value="Internet" id="recursoInternet">
          <label class="form-check-label" for="recursoInternet">Internet</label>
        </div>
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="checkbox" name="recursos" value="Videos" id="recursoVideos">
          <label class="form-check-label" for="recursoVideos">Videos</label>
        </div>
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="checkbox" name="recursos" value="Discos" id="recursoDiscos">
          <label class="form-check-label" for="recursoDiscos">Discos</label>
        </div>
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="checkbox" name="recursos" value="Correo" id="recursoCorreo">
          <label class="form-check-label" for="recursoCorreo">Correo</label>
        </div>
      </div>

      <!-- Seguro -->
      <div class="col-12">
        <label class="form-label">Documentación de Seguro</label>
        <div class="row">
          <div class="col-md-4">
            <ul class="list-group">
              <li th:each="archivo : ${archivos}" class="list-group-item">
                <a th:href="@{'/modificar?archivo=' + ${archivo}}" th:text="${archivo}"></a>
              </li>
            </ul>
          </div>
          <div class="col-md-8">
            <div th:if="${archivoSeleccionado}" class="border rounded p-2">
              <embed th:src="@{'/seguros/' + ${usuarioId} + '/' + ${archivoSeleccionado}}"
                     type="application/pdf" width="100%" height="300px"/>
            </div>
            <div th:if="${archivoSeleccionado == null}">
              <p class="text-muted">Seleccione un archivo para previsualizarlo aquí.</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Botón -->
      <div class="col-12 mt-3">
        <button type="submit" class="btn btn-primary px-4">Guardar</button>
      </div>

    </form>
  </div>

  <script>
    function previewFoto(input) {
      if (input.files && input.files[0]) {
        const reader = new FileReader();
        reader.onload = function(e) {
          document.getElementById('fotoPreview').src = e.target.result;
        }
        reader.readAsDataURL(input.files[0]);
      }
    }
  </script>
</section>
</body>
</html>
