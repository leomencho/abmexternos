<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">
<head>
  <title>Nuevo Registro</title>
</head>

<body>
<section layout:fragment="content">
  <div class="container mt-4">
    <h2 class="mb-4">Nuevo Registro</h2>
    <!-- Mensajes de √©xito o error -->
    <div th:if="${exito}" class="alert alert-success alert-dismissible fade show" role="alert">
      <span th:text="${exito}"></span>
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Cerrar"></button>
    </div>

    <div th:if="${error}" class="alert alert-danger alert-dismissible fade show" role="alert">
      <span th:text="${error}"></span>
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Cerrar"></button>
    </div>



    <form method="post" action="/api/usuarios" class="row g-3">

      <!-- Foto con preview --> <!--
      <div class="col-12 text-center">
        <label class="form-label d-block">Foto de Perfil</label>
        <label for="fotoInput">
          <img id="fotoPreview" src="/default-avatar.png" alt="Foto" class="img-thumbnail"
               style="width:150px; height:150px; object-fit:cover; cursor:pointer;">
        </label>
        <input type="file" id="fotoInput" name="foto" class="d-none" onchange="previewFoto(this)">
      </div> -->

      <!-- Nombre y Apellido -->
      <div class="col-md-6">
        <label class="form-label">Nombre</label>
        <input type="text" name="nombre" maxlength="50" class="form-control" required>
      </div>
      <div class="col-md-6">
        <label class="form-label">Apellido</label>
        <input type="text" name="apellido" maxlength="50" class="form-control" required>
      </div>

      <!-- DNI, CUIL, Fecha -->
      <div class="col-md-4">
        <label class="form-label">DNI</label>
        <input type="number" name="dni" maxlength="11" class="form-control" required>
      </div>
      <div class="col-md-4">
        <label class="form-label">CUIL</label>
        <input type="text" name="cuil" pattern="\d{2}-\d{8}-\d" class="form-control" placeholder="XX-XXXXXXXX-X" required>
      </div>
      <!-- Fecha de Nacimiento -->
      <div class="col-md-3">
        <label class="form-label">Fecha de Nacimiento</label>
        <input type="date" name="fecha_nac" class="form-control" required>
      </div>

      <!-- Tel√©fono, Email y Contrase√±a en la misma fila -->
      <div class="col-md-3">
        <label class="form-label">Tel√©fono</label>
        <input type="text" name="telefono" maxlength="20" class="form-control" placeholder="Ej: +54 9 351 1234567">
      </div>
      <div class="col-md-4">
        <label class="form-label">Email</label>
        <input type="email" name="mail" maxlength="50" class="form-control" required>
      </div>
      <div class="col-md-3">
        <label class="form-label">Contrase√±a</label>
        <input type="password" name="pass" maxlength="50" class="form-control" required>
      </div>
      <!-- Estado -->
      <div class="col-md-4">
        <label class="form-label">Estado</label>
        <select name="estadoId" class="form-select" required>
          <option value="" disabled selected>Seleccione un estado...</option>
          <option th:each="estado : ${estados}"
                  th:value="${estado.idestado}"
                  th:text="${estado.tipoestado}">
          </option>
        </select>
      </div>

      <!-- Comentario -->
      <div class="col-md-12">
        <label class="form-label">Comentario</label>
        <textarea name="comentario" class="form-control" rows="3" maxlength="500" placeholder="Ingrese un comentario adicional si lo desea..."></textarea>
      </div>

      <!-- Bot√≥n -->
      <div class="col-12 mt-3">
        <button type="submit" class="btn btn-primary px-4">Guardar</button>
      </div>

    </form>
  </div>

  <script>
    function previewFoto(input) {
      if (input.files && input.files[0]) {
        const reader = new FileReader();
        reader.onload = function(e) {
          document.getElementById('fotoPreview').src = e.target.result;
        }
        reader.readAsDataURL(input.files[0]);
      }
    }
  </script>
  <script>
    document.querySelector("form").addEventListener("submit", function (e) {
      const data = new FormData(this);
      for (const [key, value] of data.entries()) {
        console.log("üö® Campo enviado:", key, value);
      }
    });
  </script>
  <script>
    document.querySelector("form").addEventListener("submit", function (e) {
      const inputs = this.querySelectorAll("input[type='file']");
      inputs.forEach(input => {
        if (input.name === "attachment") {
          input.remove(); // borra el input que causa conflicto
          console.log("‚ùå Eliminado input 'attachment'");
        }
      });
    });
  </script>
  <!-- Footer -->
  <div th:replace="fragments/footer :: footer"></div>

</section>
</body>
</html>
